{# @var craft \craft\web\twig\variables\CraftVariable #}
{# @var field Vierbeuter\Craft\Field\ModuleField #}
{# @var name string #}
{# @var value JSON-string #}

{# the actual module field value as hidden field #}
{% include field.getTemplateRootId() ~ '/subfields/hidden.twig' with {
    config: {
        id: name,
        name: name,
        value: value,
    }
} only %}

{# all sub-fields as defined in the module field implementation #}
{# --> we can't just dynamically call macros in Twig #}
{# --> that's why we dynamically include other templates here (where the macros will be called) #}
{# --> see https://stackoverflow.com/a/55970814/3773017 for more details #}
{% for subfield in field.getSubfields(name, value | json_decode) %}
    {% include field.getTemplateRootId() ~ '/subfields/' ~ subfield.getField() ~ '.twig' with {
        config: subfield.getConfig()
    } only %}
{% endfor %}
